<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>1-Wire API for .NET: SHASoftAuth Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">1-Wire API for .NET&#160;<span id="projectnumber">Version 4.00</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>com</b>      </li>
      <li class="navelem"><b>dalsemi</b>      </li>
      <li class="navelem"><b>onewire</b>      </li>
      <li class="navelem"><b>application</b>      </li>
      <li class="navelem"><b>sha</b>      </li>
      <li class="navelem"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html">SHASoftAuth</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a>  </div>
  <div class="headertitle">
<h1>SHASoftAuth Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="com::dalsemi::onewire::application::sha::SHASoftAuth" --><!-- doxytag: inherits="com::dalsemi::onewire::application::sha::SHATransaction" -->
<p>Inherits <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html">com::dalsemi::onewire::application::sha::SHATransaction</a>.</p>

<p><a href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a23937b9f5b753d475890e5d2e1d13d8b">SHASoftAuth</a> (<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a> <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#a78ff0ab7aa37de334f7b9650b4fdc0eb">copr</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html">SHADebit</a> constructor.  <a href="#a23937b9f5b753d475890e5d2e1d13d8b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a1834033da5cb2d3fe9b6a08dabfe63b3">SHASoftAuth</a> (<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a> <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#a78ff0ab7aa37de334f7b9650b4fdc0eb">copr</a>, byte[] extra_data, int len)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html">SHADebit</a> constructor.  <a href="#a1834033da5cb2d3fe9b6a08dabfe63b3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#afde2085953708095d7f28782b76fb856">setupTransactionData</a> (<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> user)  throws OneWireException, OneWireIOException    </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">synchronized boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a96f03162a02e808f473e305ea4bfed8a">verifyUser</a> (<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> user)  throws OneWireException, OneWireIOException    </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">synchronized boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a793409b39142b332af744ba7d382f47a">verifyTransactionData</a> (<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> user)  throws OneWireException, OneWireIOException    </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">synchronized boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#aef4002374912ef09e96ba0c4fd573601">executeTransaction</a> (<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> user, boolean verifySuccess)  throws OneWireException, OneWireIOException    </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">synchronized int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a7a1ccb6ae9d104267321fa62b03eecd8">getParameter</a> (int type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">synchronized int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a2400ce545a542a08e14968b3b859f6a2">getParameter</a> (int type, byte[] data, int offset, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">synchronized boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#ad0e84b89236f21fa368ea11f8381c309">setParameter</a> (int type, byte[] data, int offset, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">synchronized boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a7d202c80348a490a39192b3e40c07715">setParameter</a> (int type, int param)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">synchronized void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a6f304fcc40f754d947ee2bb0bff81a5e">resetParameters</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a437fa084b91e8fd865085a6ed9468f88"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::VERIFICATION_DATA" ref="a437fa084b91e8fd865085a6ed9468f88" args="" -->
static final int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a437fa084b91e8fd865085a6ed9468f88">VERIFICATION_DATA</a> = 2</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the verification data. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5db64d5e4b9fec905ea3a57848f23729"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::I_FILE_LENGTH" ref="a5db64d5e4b9fec905ea3a57848f23729" args="" -->
static final int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a5db64d5e4b9fec905ea3a57848f23729">I_FILE_LENGTH</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">indices for fields in user account file <br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7f0896842e151f1805bc2349013ef585"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::SHASoftAuth" ref="a7f0896842e151f1805bc2349013ef585" args="()" -->
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a7f0896842e151f1805bc2349013ef585">SHASoftAuth</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">User apps should never call this. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This class implements an software authrization account application for SHA Transactions. The account data is stored on the user iButtons after being digitally signed by a virtual machine coprocessor. Account data consists of the following: </p>
<ul>
<li>
1 byte: Length of the account file </li>
<li>
2 bytes: Transaction ID </li>
<li>
2 bytes: Account Money Conversion Factor </li>
<li>
3 bytes: Account Balance </li>
<li>
20 bytes: Account Data Signature </li>
<li>
1 byte: Account data type (dynamic or static) </li>
<li>
1 byte: File continuation pointer </li>
<li>
2 bytes: CRC16 of entire 30 bytes seeded with the page number </li>
<li>
<b>32 bytes Total</b> </li>
</ul>
<p>A typical use case for this class might be as follows: </p>
<pre>
   OneWireContainer18 coprOWC18 = new OneWireContainer18(adapter,address);</pre><pre>   //COPR.0 is the filename for coprocessor service data
   <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a> copr = new <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a>(coprOWC18,"COPR.0");</pre><pre>   //Initial amount for new users is $100, and debit amount is 50 cents
   byte[] ver_data = new byte[] {0x00,0x01,0x02,0x03,0x04,0x05,0x06};
   SATransaction trans = new SHAsoftauth(copr, ver_data, 7);</pre><pre>   OneWireContainer18 owc18 = new OneWireContainer18(adapter, userAddress);</pre><pre>   //The following constructor erases all transaction data from the user and
   //installs the system authentication secret on the user iButton.
   <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> user = new SHAiButtonUser18(copr, owc18, true, authSecret);</pre><pre>   //creates account data on iButton
   if(trans.setupTransactionData(user))
      System.out.println("Account data installed successfully");
   else
      System.out.println("Account data installation failed");</pre><pre>   //... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...</pre><pre>   //"challenges" user iButton
   if(trans.verifyUser(user))
   {
      System.out.println("User Verified Successfully");</pre><pre>      //checks data signature
      if(trans.verifyTransactionData(user))
      {
         System.out.println("Account Data Verified Successfully");</pre><pre>         //writes verification data to user iButton
         System.out.println("User's verification data: ");
         softauth.getParameter(<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a437fa084b91e8fd865085a6ed9468f88" title="Update the verification data.">SHASoftAuth.VERIFICATION_DATA</a>,
                               ver_data,0,7);
         IOHelper.writeBytes(ver_data);
      }
   }</pre><pre>   //... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...</pre><pre>   if(trans.getLastError()!=0)
   {
      System.err.println("Error code: " + trans.getLastError());
   }
 </pre><p>This class makes use of several performance enhancements for TINI. For instance, most methods are <code>synchronized</code> to access instance variable byte arrays rather than creating new byte arrays every time a transaction is performed. This could hurt performance in multi-threaded applications, but the usefulness of having several threads contending to talk to a single iButton is questionable since the methods in <code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1adapter_1_1_d_s_port_adapter.html" title="The abstract base class for all 1-Wire port adapter objects.">com.dalsemi.onewire.adapter.DSPortAdapter</a></code> <code>beginExclusive(boolean)</code> and <code>endExclusive()</code> should be used.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html">SHATransaction</a> </dd>
<dd>
<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a> </dd>
<dd>
<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a></dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.00 </dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>SKH </dd></dl>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a23937b9f5b753d475890e5d2e1d13d8b"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::SHASoftAuth" ref="a23937b9f5b753d475890e5d2e1d13d8b" args="(SHAiButtonCopr copr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html">SHASoftAuth</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a>&#160;</td>
          <td class="paramname"><em>copr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html">SHADebit</a> constructor. </p>
<p><code>copr</code> is the <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a> that is used to perform this transaction. After saving a reference to the SHA coprocessor, this constructor resets all parameters for this type of transaction to their default values.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">copr</td><td>The coprocessor used for authentication and data signing in this transaction. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a1834033da5cb2d3fe9b6a08dabfe63b3"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::SHASoftAuth" ref="a1834033da5cb2d3fe9b6a08dabfe63b3" args="(SHAiButtonCopr copr, byte[] extra_data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html">SHASoftAuth</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a>&#160;</td>
          <td class="paramname"><em>copr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">byte[]&#160;</td>
          <td class="paramname"><em>extra_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html">SHADebit</a> constructor. </p>
<p><code>copr</code> is the <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_copr.html">SHAiButtonCopr</a> that is used to perform this transaction. After saving a reference to the SHA coprocessor, this constructor resets all parameters for this type of transaction to their default values.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">copr</td><td>The coprocessor used for authentication and data signing in this transaction. </td></tr>
    <tr><td class="paramname">extra_data</td><td>The 7 bytes of extra data to be used instead of the balance. </td></tr>
    <tr><td class="paramname">len</td><td>The len, 7 or less of the data. It is 0 padded. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="aef4002374912ef09e96ba0c4fd573601"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::executeTransaction" ref="aef4002374912ef09e96ba0c4fd573601" args="(SHAiButtonUser user, boolean verifySuccess)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized boolean executeTransaction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a>&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boolean&#160;</td>
          <td class="paramname"><em>verifySuccess</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>  throws <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1_one_wire_exception.html">OneWireException</a>, <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1adapter_1_1_one_wire_i_o_exception.html">OneWireIOException</a>    <code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Performs the signed debit, subtracting the debit amount from the user's balance and storing the new, signed account data on the user's iButton. The debit amount can be set using <code>transaction.setParameter(<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a70d3277d48be5b4725b4a550d0017864" title="Update the amount this transaction will debit.">SHADebit.DEBIT_AMOUNT</a>, 50)</code>, where the value is in units of cents (i.e. for 1 dollar, use 100).</p>
<p><b>Flow of action: </b> </p>
<ul>
<li>
Read the account data from user  </li>
<li>
Extract account balance  </li>
<li>
Reset the digital signature  </li>
<li>
Use coprocessor to sign account data  </li>
<li>
Insert the new digital signature  </li>
<li>
Write the account data to the user  </li>
</ul>
<p>If previous steps have been executed, all "Read" commands on the user are reading from cached data.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> upon which the transaction occurs. </td></tr>
    <tr><td class="paramname">verifySuccess</td><td>A boolean to let this method know if verification was successful.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><code>true</code> if and only if the user has enough in the account balance to perform the requested debit AND a new digital signature is successfully created AND the account data has been written to the button.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>SHAiButtonUser.readAccountData(byte[],int) </dd>
<dd>
SHAiButtonUser.writeAccountData(byte[],int) </dd>
<dd>
SHAiButtonCopr.createDataSignature(byte[],byte[],byte[],int) </dd>
<dd>
<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#ac21949d55d67e835061fed83fbc8c77f">getLastError()</a> </dd></dl>

<p>Implements <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#ae51d940f197a36885ebdad4d78674fc2">SHATransaction</a>.</p>

</div>
</div>
<a class="anchor" id="a7a1ccb6ae9d104267321fa62b03eecd8"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::getParameter" ref="a7a1ccb6ae9d104267321fa62b03eecd8" args="(int type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized int getParameter </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Retrieves the value of a particular parameter for this debit transaction.</p>
<p><b>Valid Parameters</b> </p>
<ul>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a70d3277d48be5b4725b4a550d0017864" title="Update the amount this transaction will debit.">SHADebit.DEBIT_AMOUNT</a></code> </li>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a4ee1596bbf4a8fc443ab2c5fd663a3a5" title="Update the amount for initial account balance.">SHADebit.INITIAL_AMOUNT</a></code> </li>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a283f3d08f912618c8b6dc9a237340169" title="Retrieve the amount for user&#39;s current balance.">SHADebit.USER_BALANCE</a></code> </li>
</ul>
<p>Note that the value of <code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a283f3d08f912618c8b6dc9a237340169" title="Retrieve the amount for user&#39;s current balance.">SHADebit.USER_BALANCE</a></code> will be set after calling <code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a793409b39142b332af744ba7d382f47a">verifyTransactionData(SHAiButtonUser)</a></code> and after calling <code>executeTransaction(SHAiButtonUser)</code>.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The value of the requested parameter.</dd></dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">IllegalArgumentException</td><td>if an invalid parameter type is requested. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#a7285b98e7a37c0ef3f575bf45987060b">SHATransaction</a>.</p>

</div>
</div>
<a class="anchor" id="a2400ce545a542a08e14968b3b859f6a2"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::getParameter" ref="a2400ce545a542a08e14968b3b859f6a2" args="(int type, byte[] data, int offset, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized int getParameter </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">byte[]&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Retrieves the value of a particular parameter for this debit transaction.</p>
<p><b>Valid Parameters</b> </p>
<ul>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a70d3277d48be5b4725b4a550d0017864" title="Update the amount this transaction will debit.">SHADebit.DEBIT_AMOUNT</a></code> </li>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a4ee1596bbf4a8fc443ab2c5fd663a3a5" title="Update the amount for initial account balance.">SHADebit.INITIAL_AMOUNT</a></code> </li>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a283f3d08f912618c8b6dc9a237340169" title="Retrieve the amount for user&#39;s current balance.">SHADebit.USER_BALANCE</a></code> </li>
</ul>
<p>Note that the value of <code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a283f3d08f912618c8b6dc9a237340169" title="Retrieve the amount for user&#39;s current balance.">SHADebit.USER_BALANCE</a></code> will be set after calling <code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_soft_auth.html#a793409b39142b332af744ba7d382f47a">verifyTransactionData(SHAiButtonUser)</a></code> and after calling <code>executeTransaction(SHAiButtonUser)</code>.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The value of the requested parameter.</dd></dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">IllegalArgumentException</td><td>if an invalid parameter type is requested. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a6f304fcc40f754d947ee2bb0bff81a5e"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::resetParameters" ref="a6f304fcc40f754d947ee2bb0bff81a5e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized void resetParameters </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Resets all transaction parameters to default values </p>

<p>Implements <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#aa3627d753f75ad8b9cda5f5946c21ea5">SHATransaction</a>.</p>

</div>
</div>
<a class="anchor" id="a7d202c80348a490a39192b3e40c07715"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::setParameter" ref="a7d202c80348a490a39192b3e40c07715" args="(int type, int param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized boolean setParameter </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets the value of a particular parameter for this debit transaction.</p>
<p><b>Valid Parameters</b> </p>
<ul>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a70d3277d48be5b4725b4a550d0017864" title="Update the amount this transaction will debit.">SHADebit.DEBIT_AMOUNT</a></code> </li>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a4ee1596bbf4a8fc443ab2c5fd663a3a5" title="Update the amount for initial account balance.">SHADebit.INITIAL_AMOUNT</a></code> </li>
</ul>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">type</td><td>Specifies the parameter type (<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a70d3277d48be5b4725b4a550d0017864" title="Update the amount this transaction will debit.">SHADebit.DEBIT_AMOUNT</a></code> or <code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a4ee1596bbf4a8fc443ab2c5fd663a3a5" title="Update the amount for initial account balance.">SHADebit.INITIAL_AMOUNT</a></code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if a valid parameter type was specified and the value of the parameter is positive.</dd></dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">IllegalArgumentException</td><td>if an invalid parameter type is requested. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#ac780b8be7f3e9ca75832d7805f0d2465">SHATransaction</a>.</p>

</div>
</div>
<a class="anchor" id="ad0e84b89236f21fa368ea11f8381c309"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::setParameter" ref="ad0e84b89236f21fa368ea11f8381c309" args="(int type, byte[] data, int offset, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized boolean setParameter </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">byte[]&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets the value of a particular parameter for this debit transaction.</p>
<p><b>Valid Parameters</b> </p>
<ul>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a70d3277d48be5b4725b4a550d0017864" title="Update the amount this transaction will debit.">SHADebit.DEBIT_AMOUNT</a></code> </li>
<li>
<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a4ee1596bbf4a8fc443ab2c5fd663a3a5" title="Update the amount for initial account balance.">SHADebit.INITIAL_AMOUNT</a></code> </li>
</ul>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">type</td><td>Specifies the parameter type (<code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a70d3277d48be5b4725b4a550d0017864" title="Update the amount this transaction will debit.">SHADebit.DEBIT_AMOUNT</a></code> or <code><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a4ee1596bbf4a8fc443ab2c5fd663a3a5" title="Update the amount for initial account balance.">SHADebit.INITIAL_AMOUNT</a></code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if a valid parameter type was specified and the value of the parameter is positive.</dd></dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">IllegalArgumentException</td><td>if an invalid parameter type is requested. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="afde2085953708095d7f28782b76fb856"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::setupTransactionData" ref="afde2085953708095d7f28782b76fb856" args="(SHAiButtonUser user)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boolean setupTransactionData </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a>&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td>  throws <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1_one_wire_exception.html">OneWireException</a>, <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1adapter_1_1_one_wire_i_o_exception.html">OneWireIOException</a>    <code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Setup account data on a fresh user iButton. Prior to calling setup transaction data, the authentication secret for the iButton should already be setup and a directory entry (as well as at least an empty placeholder file) should exist for the account data. If you constructed the <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> using <code>SHAiButtonUser(SHAiButtonCopr,OneWireContainer18,boolean,byte[])</code> the secret has been setup for you and you should know call this function. If you try to install the authentication secret after creating the account data, you will destroy all account data on the iButton.</p>
<p>You can set the value of the intial account balance by calling <code>transaction.setParameter(<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_debit.html#a4ee1596bbf4a8fc443ab2c5fd663a3a5" title="Update the amount for initial account balance.">SHADebit.INITIAL_AMOUNT</a>,10000)</code> where the value of the units is in cents (i.e. 10000 = $100).</p>
<p><b>Flow of action: </b> </p>
<ul>
<li>
Generate generic account page  </li>
<li>
Insert the initial balance into account data  </li>
<li>
Create a signature using coprocessor  </li>
<li>
Insert the digital signature  </li>
<li>
Write account data page to iButton  </li>
</ul>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> upon which the transaction occurs.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><code>true</code>if and only if the signature is successfully created by the coprocessor AND the data is successfully written to the user iButton.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>SHAiButtonCopr.createDataSignature(byte[],byte[],byte[],int) </dd>
<dd>
SHAiButtonUser.writeAccountData(byte[],int) </dd>
<dd>
<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#ac21949d55d67e835061fed83fbc8c77f">getLastError()</a> </dd></dl>

<p>Implements <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#a2cfdd1a0369a6bda99d047236e42bf13">SHATransaction</a>.</p>

</div>
</div>
<a class="anchor" id="a793409b39142b332af744ba7d382f47a"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::verifyTransactionData" ref="a793409b39142b332af744ba7d382f47a" args="(SHAiButtonUser user)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized boolean verifyTransactionData </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a>&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td>  throws <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1_one_wire_exception.html">OneWireException</a>, <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1adapter_1_1_one_wire_i_o_exception.html">OneWireIOException</a>    <code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Verifies user's account data. Account data is "verified" if the digital signature matches the signature recreated by the coprocessor.</p>
<p><b>Flow of action: </b> </p>
<ul>
<li>
Read the account data from user  </li>
<li>
Get verification data  </li>
<li>
Reset the digital signature  </li>
<li>
Use coprocessor to sign account data  </li>
<li>
Insert the new digital signature  </li>
<li>
Write the account data to the user  </li>
</ul>
<p>If previous steps have been executed, all "Read" commands on the user are reading from cached data.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> upon which the transaction occurs.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><code>true</code> if and only if the account balance is greater than zero and digital signature matches the signature recreated by the coprocessor.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>SHAiButtonUser.readAccountData(byte[],int) </dd>
<dd>
SHAiButtonCopr.verifySignature(byte[],byte[],byte[]) </dd>
<dd>
<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#ac21949d55d67e835061fed83fbc8c77f">getLastError()</a> </dd></dl>

<p>Implements <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#a1156e4d9b90a949ceced9628f3243d81">SHATransaction</a>.</p>

</div>
</div>
<a class="anchor" id="a96f03162a02e808f473e305ea4bfed8a"></a><!-- doxytag: member="com::dalsemi::onewire::application::sha::SHASoftAuth::verifyUser" ref="a96f03162a02e808f473e305ea4bfed8a" args="(SHAiButtonUser user)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized boolean verifyUser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a>&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td>  throws <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1_one_wire_exception.html">OneWireException</a>, <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1adapter_1_1_one_wire_i_o_exception.html">OneWireIOException</a>    <code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Verifies user's authentication response. User is "authenticated" if and only if the digital signature generated the user iButton matches the digital signature generated by the coprocessor after the user's unique secret has been recreated on the coprocessor.</p>
<p><b>Flow of action: </b> </p>
<ul>
<li>
Generate 3-byte "challenge" on coprocessor  </li>
<li>
Write challenge to scratchpad of user  </li>
<li>
Read account data page with signature  </li>
<li>
Attempt to match user's signature with the coprocessor  </li>
</ul>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td><a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_ai_button_user.html">SHAiButtonUser</a> upon which the transaction occurs.</td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd>SHAiButtonCopr.generateChallenge(int,byte[],int) </dd>
<dd>
SHAiButtonCopr.verifyAuthentication(byte[],byte[],byte[],byte[],byte) </dd>
<dd>
SHAiButtonUser.readAccountData(byte[],int,byte[],int,byte[],int) </dd>
<dd>
<a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#ac21949d55d67e835061fed83fbc8c77f">getLastError()</a> </dd></dl>

<p>Implements <a class="el" href="classcom_1_1dalsemi_1_1onewire_1_1application_1_1sha_1_1_s_h_a_transaction.html#a88982428d4712af0c31482f26c9de130">SHATransaction</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>SHASoftAuth.java</li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Dec 6 2012 09:24:55 for 1-Wire API for .NET by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
